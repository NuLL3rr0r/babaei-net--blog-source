cd /usr/ports/devel/ruby-gems
make config-recursive
make install clean

cd /usr/ports/net/rubygem-oauth
make config-recursive
make install clean

mkdir -p /srv/babaei.net/cron

nano -w /srv/babaei.net/cron/update_twitter.rb
########
#!/usr/bin/env ruby
require 'rubygems'
require 'oauth'

# Edit config to suit your needs
config = {
  :consumer_key => 'p8TPfx55luGDmTl4Eusz27EcI',
  :consumer_secret => 'P8xD3m8Qon9zTvO6KLikLRaxif0EcDoubNNNaykOayVh8JCyKl',
  :oauth_token => '34993003-1lXXtZduuuFmezBhucv5C1n4XftBTM5kJfpc8xCci',
  :oauth_token_secret => 'srAOMty5LKumpJu7DlPSXWvfYKrblASTps43BxTJ4Bbcv',
  :output_path_en => '/srv/babaei.net/wen/twitter_timeline.json',
  :output_path_fa => '/srv/babaei.net/wfa/twitter_timeline.json'
}

# Create OAuth context
oauth = OAuth::Consumer.new(
  config[:consumer_key],
  config[:consumer_secret],
  { :site => "http://twitter.com", :scheme => :header }
)
access_token = OAuth::AccessToken.from_hash(
  oauth,
  { :oauth_token => config[:oauth_token], :oauth_token_secret => config[:oauth_token_secret] }
)

# Get timeline
url = 'https://api.twitter.com/1.1/statuses/user_timeline.json?screen_name=NuLL3rr0r&trim_user=true&count=22&include_entities=1&exclude_replies=1'
response = access_token.request(:get, url)

# Write response into output file with JSONP wrapper
File.open(config[:output_path_en], 'w') { |file|
  file.write('processTweeter(')
  file.write(response.body)
  file.write(');')
}
File.open(config[:output_path_fa], 'w') { |file|
  file.write('processTweeter(')
  file.write(response.body)
  file.write(');')
}
########

nano -w /srv/babaei.net/cron/update_twitter.sh
########
#!/bin/sh

# WON'T WORK AS A CRON TASK
#cd "$(dirname "$0")"
#ruby update_twitter.rb

sudo -u www -g www -H /usr/local/bin/ruby /srv/babaei.net/cron/update_twitter.rb
########

chown www:www /srv/babaei.net/cron/update_twitter.rb
chown www:www /srv/babaei.net/cron/update_twitter.sh
chmod 0700 /srv/babaei.net/cron/update_twitter.rb
chmod 0700 /srv/babaei.net/cron/update_twitter.sh
ls -l /srv/babaei.net/cron/

// Test it with the limited set of environment variables set by cron
env -i SHELL=/bin/sh PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/etc/:/usr/local/bin:/usr/local/sbin HOME=/root LOGNAME=Charlie /srv/babaei.net/cron/update_twitter.sh

crontab -e -u root
########
SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/etc/:/usr/local/bin:/usr/local/sbin
MAILTO=""

# babaei.net/fa.babaei.net Twitter updater for Octopress
# Evey 8 minutes
*/8     *       *       *       *       /srv/babaei.net/cron/update_twitter.sh
########

crontab -l

